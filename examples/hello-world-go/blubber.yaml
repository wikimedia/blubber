# syntax=registry:5000/blubber:test
version: v4
variants:
  build:
    base: golang:1.18
    runs:
      environment:
        CGO_ENABLED: "0"
    builders:
      - custom:
          requirements: [go.mod, go.sum]
          command: "go mod download"
      - custom:
          requirements: [main.go]
          script: |
            #!/bin/bash
            if ! [[ "$CGO_ENABLED" == "0" ]]; then
              echo "you must set CGO_ENABLED=0 for this build"
              exit 1
            fi
            go build $(go list)
  application:
    copies:
      - from: build
        source: ./hello-world-go
        destination: /hello
    entrypoint: [/hello]
