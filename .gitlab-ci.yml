stages:
  - test
  - rehearse
  - publish

test:
  stage: test
  image: docker-registry.wikimedia.org/golang:1.13-3
  before_script:
    - go get -u golang.org/x/lint/golint
  script:
    - make test

# build-image:
#   stage: build
#   tags: [buildkitd]
#   image:
#     name: moby/buildkit:master-rootless
#     entrypoint: [ /bin/sh, -c ]
#   variables:
#     BUILDKITD_FLAGS: --oci-worker-no-process-sandbox
#   script:
#     - |-
#       echo $FOO
#       buildctl-daemonless.sh \
#         build --frontend gateway.v0 \
#         --opt source=docker-registry.wikimedia.org/wikimedia/blubber-buildkit:0.9.0 \
#         --local context=. \
#         --local dockerfile=. \
#         --opt filename=.pipeline/blubber.yaml \
#         --opt variant=test